# Breaking Monero 08: Timing Attacks

**Breaking Monero Episode 08: Timing Attacks**

https://youtu.be/v77trz2VlLs

Information on when users run nodes, sync wallets, and send transactions can be used to learn more about Monero users. We discuss some of the network topography concerns and offer some ways for users to mitigate their exposure to timing heuristics. 

_**Episode Transcription**_
---

_**Justin:**_ Hello and welcome back to Breaking Monero, the series where we critically look at some of Monero privacy and security limitations in order to inform people about what these are. I’m Justin and we’re happy to have Sarang back today also. Today we’re talking about timing attacks. Timing attacks are another very nuanced topic, so we want to help explain the situation a little bit better for people so they have a better understanding about what kind of information can be learned them and some key takeaways that users can consider and use as they’re sending transactions. So Sarang, can you start us off with some of the considerations about when you are running a node, what the sort of limitations there are?

_**Sarang:**_ Sure, the idea behind running a node is that you may be relaying transactions from other nodes onto the network, which of course is basically how the network learns about transactions. But you yourself may be constructing transactions and sending them yourself, so timing about when your node is active, when it is accepting incoming connections and making outgoing connections to other nodes may reveal a little bit of information about the transaction structure. For example, if I have a node that’s running 24/7 and has a whole bunch of transactions passing through it, it may be more difficult for an adversary to determine which of those transactions I’m simple relaying on and which actually originated from me. But if I only come online every so often, for a brief period of time, send out a transaction or two and then go back offline; that may be an indication to that adversary that the transactions being sent out were originated by me. So the timing about when a node is running, is something to consider. We know that in general, the more nodes that are online relaying transactions increase the security of the network anyway.

_**Justin:**_ Do you think that it’s fair to say that if an adversary was trying to have a high level of knowledge over the network, that they would look first at nodes that have recently connected to and have disconnected over a short period of time?

_**Sarang:**_ It’s difficult to say what methods an adversary might use, but that’s a pretty strong one. In general, if you going to be using a node, it’s probably best to leave it running all the time and allow a lot of transactions to filter through it and be relayed in order to ensure that your transactions are as hidden as possible within that crowd.

_**Justin:**_ Thanks Sarang, it’s worth noting too that this isn’t really a Monero specific recommendation. For other security and privacy software like Tor or I2P, they generally recommend that users run the software all the time, even if you’re not using it. You should not use an I2P router only when you’re routing on the I2P network, likewise, you should not run a node only if you want to synch and broadcast transactions. Ideally you should run them all the time. What about when your synching with a remote node Sarang?

_**Sarang:**_ Well we were talking about this earlier, before the recording, about how the structure is a little bit different. We talked about remote nodes, the limitations and the trust that you’re implicitly placing in a remote node. For example, if you connect with a mobile device that doesn’t have the capability to run one on it’s own. One thing to keep in mind is that, especially on a mobile device whose IP and geolocation is going to be changing over time, if you connect to a remote node and request blocks that you haven’t seen yet. For example, if I run a Monero wallet on my phone that’s connecting to some open remote node, that node sees that I request a certain number of blocks, and then maybe I go offline, stop connecting to it because I’m done for a while. And then from a different location, a different IP I appear to be a different identity, I might connect to that same remote node again and start requesting the next set of blocks. So if a remote node is keeping track of which entities are requesting which sets of blocks, the node might make inferences about if I am that same entity, even though my phone is connecting from a different IP.

_**Justin:**_ Interesting, thank you Sarang. To move on a little bit, we can summarize when people send transactions and what people can do to mitigate some misinformation. There are some basic strategies that we have outlines, and they each come with their own drawbacks unfortunately. So we can say that users should send randomly, literally pick a random time over a day, but then maybe you would choose an off-peak time for the Monero network and maybe the only people sending transactions at that time are only those who are sending by a random parameter. Or maybe if you send them during time when more people are using the network, it could be more of a predictable behavior that people might try to observe. Ultimately, it’s hard to say which one is the best because you can develop a heuristic for both of these and we don’t know which one is more powerful. So just know that there are limitations with both of these strategies and how people approach them. We can look to the ZCash turnstile process to see how they sought to limit some of the timing attack metadata as people send funds from a shielded sprout address, to a transparent address, to a sapling address. With their turnstile process, they tried to make it so that you fit in with the rest of the crowd with an interactive process, where you try to make sure that many people are doing it at the same time. The main point of that is to help with timing attacks, to make it not obvious that only one entity is transacting over certain periods of time. So Sarang, one question that a lot of people have with the Monero wallet, and it’s kind of a user experience drawback, is that we limit people to have at least 10 confirmations for their transactions, before they’re able send another one. Why does Monero do this and what are the benefits?

_**Sarang:**_ One of the ideas behind this, we talked about this before back when we talked about forks in the network, that the network and the chain will tend to fork itself in small and limited ways just because different miners may come up with different blocks around the same time and create these little tiny tributary style forks. Eventually those get rolled into one solid chain. So on one hand, we want to make sure that users have enough confirmations to ensure that the outputs they are sending are on the main chain. How many blocks does that take? Statistically we know that the more blocks you wait, the more likely that you are on the main chain. The longest reorganization of chains that we’ve seen are on the order of 20 blocks, but these are extremely rare, it’s more likely that the number we’ve set, 10 blocks, ensures that you’re very, very likely on the main chain without degrading the user experience too much. We could talk about other benefits that we get from this as well.

_**Justin:**_ Yeah sure. On top of that too, you don’t want to generate transactions with decoys that were generated on a chain that doesn’t exist anymore. Either the transaction won’t be properly verified, actually that’s a good question Sarang, would the transaction just not be verified or would it be verified with information that everyone knows would be false?

_**Sarang:**_ It would have to be with information that is relative to that nodes knowledge of the chain.

_**Justin:**_ Interesting, ok, so you couldn’t send a transaction using a decoy in one chain and for it to be included on the network.

_**Sarang:**_ This is one of those things that eventually small tributary forks just kind of go away eventually as a solid, single main chain is established over time. In general, it’s good to wait, it’s not really a consensus thing, it’s a wallet thing, but it’s there for a good reason. It’s also worth noting that the decoy selection algorithm, that in some sense does take timing into account, also does account for this. If you’re doing the default behavior, in that sense, the output selection is taking it into account.

_**Justin:**_ To summarize, the 10 confirmation window is to make sure that people’s transactions get broadcast to the right chain and it’s also to account for latency issues with the selection output, were not everyone would see everything except for a certain period of time. It’s makes sure the entire network has visibility over this transaction before you just try to send another one. Does that summarize it pretty well?

_**Sarang:**_ To make a long story longer, sure.

_**Justin:**_ Perfect. What about some of the connections between IP addresses and timing? We’re going to have a separate episode entirely about IP addresses to go into much more detail there, but what about the portions specifically related to the incremental advantage of timing can provide to an adversary?

_**Sarang:**_ An adversary that is looking for you and is aware of you IP address, there’s some things involved with geolocation with IP addresses, there’s also information caused by what transactions are coming out of that, what time is that node active, you can make a lot of inferences based on activity. Things like time zone could give you inferences about location, so there’s a lot of pieces of metadata that are floating around there. If for example you can make an inference about a user’s time zone, you might be able to make an inference about when they’re to be asleep and therefore probably not active sending transactions on the network. All of this gives out some little heuristic information about when you see transactions, what you know about when that user is likely to send transactions of their own. This goes back to the whole idea of can I infer that a transaction I see coming out of a node is simply being relayed by someone else or originated from that node. Ideally, you don’t want that to be determined, you want all transactions to appear equally likely to have come from you or someone else. If you think about it hard enough, you can come up with a whole bunch of different heuristics that an adversary might use based on your IP and different forms of timing, time zone and location.

_**Justin:**_ Are there any last comments that you want to add on timing metadata before we move on to actionable information for people?

_**Sarang:**_ Just that some of the things are specific to Monero, for example, how we select decoys and therefore have to account for certain timing things, but most of these other things are a lot more general to the way that networks are generally setup, the way that routing happens, the way that transactions are broadcast that might not be specific to Monero, but might be common to other assets like Bitcoin and Litecoin for example. Just that in general, the goal for a lot of these things is to ensure that you’re hidden in a crowd and don’t stand out with what you’re doing. There are different mitigations and solutions that folks are trying to come up with, network level solutions like Tor, I2P and other things you might have heard of, to different kinds of routing solutions. There are proposals on how to change the way that your node connects to and routes transactions in order to make sure that an adversary observing the whole network is less likely to be able to determine any information. Like many things, and many things involving network theory, there are a lot of different layers that we can act at and Monero always tries hard to apply an iterated, layered approach to it’s privacy. We continue to iterate on that at the routing and network layers, albeit, a bit more slowly than we would like.

_**Justin:**_ Yeah, it really is it’s own sort of topic, because we don’t just need to learn from Monero’s history, we can really pull from any period of network stuff. So for this actionable information, we have a few basic steps for people. The first and most obvious one is if you can, run your own full node and keep it running 24/7. Make sure it’s always connected, don’t only run it and synch it when you’re trying to send transactions. You should ideally be contributing all the time so you’re constantly sending information back and forth, your sending transactions onto node that you didn’t yourself send, and as a result it helps you with your security. One thing that I think is pretty interesting, is if you run an open node, a [MoneroWorld](https://moneroworld.com/) style node, where other people connect to your node in order to be able to send their transactions, that can help your privacy by making it so that many other people are sending transactions through your node, not just you. In addition to all the other normal propagation data that’s being sent from your node, you’re also getting brand new information from other people that’s coming from your node for the first time. If an adversary is observing your node, they will struggle to differentiate transactions that you send out versus transactions that other people send out. What do you think about transaction delay?

_**Sarang:**_ I think that’s something that’s helpful as well, some people and other projects as well, might advocate the idea of delaying when a transaction is sent out, relative to when it is actually constructed on your device. That can be helpful, anything that you can do to ensure that patterns in your transaction behavior is randomized is generally a good thing. To what extend you should do that randomization, over what time period, I would say is up for debate. It might depend on other factors involving patterns in network activity, but in general, if you can do it, it’s probably worth your while.

_**Justin:**_ So Sarang, we’ve just spent some time talking about the timing attacks. Is this really a consideration that most people really need to concern themselves with?

_**Sarang:**_ Like a lot of other things, I think it really depends on your particular threats and risk model. A lot of it might depend on whether or not your operating through VPNs or other kinds of anonymity networks, whether or not you are concerned with adversaries observing your network activity in particular or the global network activity across the entire Monero network. It could have to do with how well connected you happen to be to the internet and to other peers on the network. It might depend on the level of trust you place with your ISP or the internet backbone around you. For most people, what we’re trying to do is ensure that the way that we develop the software, routes, connects to other nodes on the network, and other things like network layer solutions; ideally try to make some of this transparent to the user. I would say that it’s probably not something that a lot of people think about very often, and frankly a lot of people are probably privileged enough to not have to worry about this for their particular use cases. But if this is something that does concern you, then some of these mitigations is probably something you want to consider when you’re using Monero or for that matter, when you’re doing general network connectivity at all.

_**Justin:**_ All right, any final comments you want to have on this topic?

_**Sarang:**_ It’s very subtle, and every mitigation you come up with for some kind of timing analysis, there’s probably another heuristic that a very determined or different adversary might use. And that’s not to say that you should fall into an analysis paralysis trap of saying that there will always be new heuristics, so why use this at all? As always, this is a kind of cat and mouse game for which we try to iterate, maybe sometimes more slowly than we would like, but we still do iterate and improve on it.

_**Justin:**_ Okay, thank you Sarang. Thanks again for everyone who watched. This has been Breaking Monero, we will catch you the next time. Bye everyone.
