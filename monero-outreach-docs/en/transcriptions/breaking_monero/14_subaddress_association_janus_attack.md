# Breaking Monero 14: Subaddress Association (Janus Attack)

**Breaking Monero Episode 14: Subaddress Association (Janus Attack)**

https://www.youtube.com/watch?v=M_IYzzC5Zqk

In this episode, Justin discusses Monero subaddress association that can be done with off-chain and on-chain transactions. He introduces the Janus Attack that allows users to associate subaddresses with other subaddresses and with exchanges, depending on a specific set of criteria.

_**Episode Transcription**_
---

**Justin**

[00.00] Hello, and welcome back to another episode of Breaking Monero.

[00:05] Today it's just with me, Justin. Surang and Surae are busy off doing other things; you'll have to catch them in a future episode, but today I'm talking about a very important topic: subaddress association.

[00:17] I'm going to talk about two main types of subaddress association: association that can be done off-chain, and association that can be done on-chain based off transaction data, and how you assume different subaddresses entities are associated. Let's jump straight into the first one, which is something that —in the Monero community— we're calling the Janus attack.

[00:38] So let's look at this transaction graph here. Let's say that Eve works for an employer that sells Chicago Cubs hats, and Eve also runs a side business, entity one, that sells Chicago White Sox hats. Okay? Huge no-no going one here, right? So, let's say Eve's employer starts to become suspicious that Eve is running a side business; Eve's employer *could* generate a transaction that sends funds to entity one. Suppose that entity one automatically processes the transaction -as any transaction processing software would do-, but Eve's employer constructs the transaction in such a way that entity one only receives it if both Eve's salary receiving address from the employer and the entity one payment acceptance address are derived from the same seed, then Eve's employer is able to learn some more information.

[01:44] So let me take a real small step back and summarize that again, because I know it got complicated. Eve's employer will try and determine whether or not the address that the employer uses to pay Eve's salary and the address provided by the entity one are generated or derived from the same master Monero seed.

[02:09] To do so, Eve's employer can generate a transaction, sent to entity one, but entity one only receives it, if this subaddress with entity one and the subaddress sent to Eve for salary payment are controlled by the same seed, Eve's employer **would** know if this was the case, if entity one -the payment processor component- processes the payment and continues on, then Eve's employer would know it was successful.

[02:40] If the entity one payment processor does *not* report receiving any transaction, Eve's employer would know that the funds that were sent to the entity one were lost forever and the subaddresses that Eve controls personally, and the subaddress controlled by the entity one were derived from two separate seeds. So in this case, of course, Eve's employer was able to know that these two are related to the same seed, but let's go through the example where Eve is pretty smart and she uses a separate seed for entity one instead of the same seed, so it's still related to Eve —that's what this gray line is for instead of the blue line— but, instead of a subaddress, entity one has it's entire own set of private keys. It's own seed.

[03:35] So, Eve's employer tries to send a transaction to entity one that only goes through if Eve's personal subaddress is also part of the same seed you wouldn't know that it would not go through, and therefore Eve's employer is not able to create this subaddress association.

[03:54] Let's take a look at it from a third example with exchange information. So, suppose Eve this time wants to deposit funds on an exchange, so she opens up an exchange deposit account; the exchange gives Eve a deposit subaddress for her to use to identify payments that she makes on the exchange. However, let's say a subaddress comes across from a friend and she wants to know if this subaddress is an exchange subaddress that is provided by the same exchange. Well, what Eve could do is she could construct a transaction to herself, so she can send a transaction to her own subaddress that is provided by the exchange, on the left there, but she can make it such that it's only received there if the second, middle deposit subaddress is actually derived from the same seed also. So if Eve is able to notice that she sees funds show up in her account, she can confirm that the second subaddress she was provided is also an exchange account derived from the same seed. However, if she is not credited funds, she would know that they're lost forever and that the second subaddress is not associated with the exchange's same seed. So that's another way where, at relatively little cost, in by Eve providing her own confirm —because she's sending funds to herself, essentially, you know, through the exchange— that she's able to learn, or sort of scan subaddresses as they come in to see —again, at little cost— whether or not they're related to specific exchanges.

[05:38] Again, if you can even see that if it was successful, she would know that the deposit address, too, is linked to an exchange.

[05:44] Now I want to make one thing really, really clear, because I know a lot of people make this mistake: when I'm referring to "subaddress association", I'm referring to the *links between the identities that are behind the subaddresses*; I am *not* referring to transactions that are associated with the subaddresses. This is really, really important. So, if you're able to make associations like this between subaddresses, you still have no idea which transactions are associated with these subaddresses, so keep that in mind. That is still something that the attacker has no knowledge of.

[06:20] So what requirements are necessary to pull off a Janus attack?

[06:24] Well, so first, you need to know that Eve it is using a subaddress that is connected to a single private key or a single seed, is an easier way to think about it. The accounts are irrelevant, so it doesn't matter how they're derived from the seed, whether it's a subaddress in one account or another account. As long as it's a subaddress from the seed, it's susceptible, so keep that in mind.

[06:47] Second, you have to know that the attacker is knowledgeable of the subaddress's existence in the first place, and would have a reason to test it. You can't generate a subaddress on your computer, never give it to anyone else, and then be attacked, because no one else knows what the subaddress is. So keep in mind who you're giving the subaddresses to; you may have far less exposure than you think. And then if, if that's the case, then the attacker would, perhaps, try to create a transaction that is received by Eve if both subaddresses are derived from the same seed.

[07:24] And then on the third point, there has to be a confirm. So whether or not it is Eve confirming, "Yes, I received the transaction", manually or programatically, not pragmatically, or whether it's the case that it's the exchange issuance where the attacker is able to provide their own confirm because they have visibility over one of the subaddresses derived from the seed, there just needs to be some way to confirm it actually went through, because otherwise the transaction would be lost and there's no actual connection there.

[07:57] Those are the three things you need to focus on; the three attack requirements for the Janus attack to be successful in the current state of Monero. So what are some mitigations that users can do? Well, the first two are protocol-level changes that Monero has not implemented and there still is some debate over whether or not they should be implemented for efficiency reasons, because they add additional transaction size. The first is to encrypt the tx private key and send it as part of the transaction; the second option is to publish a Schnorr signature proving knowledge of the tx private key corresponding to the tx public key on a specific base point.

[08:39] I'm not going to get into either of those specifics for this episode; this is supposed to be pretty simple. Surang and Surae will be able to answer questions, along with several others, in the Monero research lab IRC channel if you have additional questions there. However, in relation to things people can do right now, I've bolded a few of the main ones that people can do that are realistic.

[08:56] So first, if you can, do not confirm receipt of funds. If someone's like, "Hey, did I send funds to you?", you don't necessarily have to say yes, alright, so keep that in mind. If you are not confirming receipt of funds, and you're the only one that has access to subaddresses derived from that seed, then there's no way for an attacker to prove that these are actually associated.

[09:17] The fourth point here. If you really are one that is worried about the disassociation of your identities —let's say that you're Eve and you're running a separate, after-work company— well then, you should be using completely different seeds, and you should be using subaddresses derived from different seeds, depending on what identity you're trying to use. Definitely the best protection you can do now is to use separate seeds if you're willing to compromise on that usability front.

[09:48] Fifth point is just don't share exchange deposit subaddresses with others. Tell a friend to send funds to a subaddress that you control and *then* send it to the exchange, otherwise it's really trivial for most people to be able to test whether or not a subaddress is related to an exchange at relatively low cost.

[10:09] The sixth point is, in general, and in addition to exchange subaddresses, you can just be mindful of who you're giving the subaddresses to. If they are people you generally trust or they're people that you are more worried about or they're more worried about counterparties, you should consider using a different seed, such that they're not trying to collude to connect some of your identities together, especially if you're negotiating under the pretense of it being a different identity.

[10:38] The seventh point is: there may be something else clever that we've thought of after this video came out, so certainly stay up to date in relation to how subaddresses provide protections and what they mean for ultimate users, because it's very likely that people come up with some other solution that just hasn't come out before this video, so keep that in mind too.

[10:57] Just to help quell everyone's nerves, I'm going to walk through the different levels of protections provided by different address uses for off-chain learning of information because I know people are like, "I thought subaddresses were perfect, and now they're not", so this helps clarify things for people. For most people, you don't need to worry; there's still a reasonable level of protection provided by subaddresses with a really lovely user experience. However, for the people who are willing to go a step further, you still have the option of using a separate seed, and we'll talk about what those specific benefits are.

[11:37] If you are reusing your main address that starts with four, or you are using an integrated address — integrated addresses are derived from the main address, so everyone is able to derive the main address when given an integrated address. If you give one integrated address to one person and another one to another user, they're able to know they're the same main address — then they might provide some protection against a passive observer. It would only be known if you publish it publicly; if you don't publish it publicly and you only deal with counterparties, well then perhaps you don't even need to worry. However, once you start dealing with counterparties, whether malicious or not, they're able to determine, "Hey, I've seen this address before, like, I know who gave it to me in the past, now I know you're giving it to me, so I'm able to connect these identities together based off the address that these people have provided."

[12:37] So, for any kind of counterparty interaction, you're much, much better off using subaddresses and you're still better off using them against passive observers too if you're publishing addresses online, for instance, because passive observers are less likely to receive access to information.

[12:54] Now, for the malicious counterparty component, this is someone who's actively trying to learn more information about you and willing to burn funds in the process. Subaddresses might not be the best case when you're interacting with these malicious counterparties. However, of course, it depends on what access to information these counterparties have. If they know the subaddress they use to pay you, but they don't know of any of your other subaddresses, there's no other identity that they can reasonably try to link to you, so it's dependent on the access to information or the availability of information to this malicious counterparty.

[13:34] However, if you *are* concerned that malicious counterparties are able to get access to several different subaddress information and are willing to test those, you should be separating your different identities by using separate seeds if possible. That provides the highest degree of protection against malicious counterparties but, of course, it's kind of frustrating to log into many different Monero accounts so, for most users, subaddresses still are a really, really good way to help manage your OpSec.

[14:06] Now, you have to remember that a few years ago with Monero, everyone was using integrated addresses, and subaddresses weren't a thing. So subaddresses still provide an enormous user experience benefit for users' OpSec over what previous solutions were available where it was just perhaps unrealistic for a user to have a separate seed all the time.

[14:29] Now that we've talked about the off-chain subaddress association, let's talk about some of the on-chain stuff. You will note that this looks very, very similar to the poisoned output attack, and that's because it does, effectively, function the same way. Let's say Eve (up here) is sending funds to a large number of subaddresses and Alice controls all of these subaddresses, and Eve is sort of suspicious, let's say, and wants some on-chain data to help prove that Alice is associated with these subaddresses. In this case, we're going to have Eve collaborate with an exchange, so this is very, very similar to the EAE attack that we described in the previous episode.

[15:11] Let's say Eve sends funds to one subaddress that is selling Chicago Cubs hats and there are several transactions that each use this output that she sent, and then one of them, Alice transfers to the exchange there. Let's say, then, that Eve sends a second transaction to a Chicago White Sox store that goes to Alice and Alice deposits it on her exchange account, then a Saint Louis account, and then finally a Minneapolis Twin Cities account.

[15:51] In this case, if Eve's able to work with the exchange, they might say, "Okay, the likelihood that these subaddresses **all** are connected to one person depositing funds on the exchange makes it very clear that Alice is the individual or entity that has very likely control over all of these subaddresses". So that's some way that Eve and the exchange are able to work together to learn more information.

[16:22] Now let's take the exchange out of it. I'll still keep the exchange on the slide for convenience, but let's say that Eve is just generally curious and Alice is a little bit less intelligent in this example. Eve is going to send the same transactions as before, but Alice takes all of these accounts, all the funds they have received, and combines them in a single transaction -groups all the outputs together- before sending it to the exchange. Well then, Eve might say, "Okay, what is the likelihood that a single transaction contains all of the outputs that I sent to all of these different subaddresses, and that they were all included in distinct, individual rings?" The money sent to the Cub subaddress is in one ring; the Sox subaddress is in another ring. This is not likely to happen by chance, and so Eve might use that as evidence to state that all of these four accounts are related to one shared entity based on the way that the transaction graph appears —based on the way that Alice constructed these transactions.

[17:30] Again, in this particular example, Eve might not even know Alice's identity necessarily, but Eve would know —based off the transaction graph information— that there is some likely connection between these four different stores. They're likely owned by a shared entity.

[17:46] So we've gone over the basics and I want to end with a summary here. First, subaddresses *are* better at providing unlinkability than integrated addresses, but they're not perfect. Power users *should* use addresses derived from independent seeds for the best privacy, but this does come at the cost of convenience. So just know what the limitations are if you are dealing with higher risk things with Monero, you should certainly understand what the limitations are, and be willing to use separate seeds as needed in order to keep your identities distinct.

[18:23] The third point is really important, and this is related to the on-chain transactions graph stuff I'm talking about: for the on-chain stuff, it wasn't a direct subaddress link that impacted users and related it to one entity; instead, it was what the entity did on-chain with their transactions that linked these subaddresses together, so subaddresses alone don't magically remove the concerns with on-chain matching. All of the concerns that we've talked about in past episodes of Breaking Monero and I'm sure we'll talk about in future episodes too. They're a really effective tool that can be beneficial to help prevent unlinkability, but the don't solve the problem entirely. There are many things that work together to help attackers learn information about transactions, so keep all of these things in mind.

[19:17] You might be sending transactions just among trusted counterparties, but an outside observer might know that the graph looks weird, and so they might be able to use that as useful information. The fourth point I want to emphasize is that subaddresses function as desired for most use-cases. In terms of subaddresses provide, sorry I meant to say subaddresses there not stealth addresses, in both of those cases, subaddresses do in fact really, really help to allow normal users, casual users of Monero have much better OpSec than using integrated addresses at very, very low effort, so for all of those users, you can carry on pretty well-assured, knowing that this is a relatively niche attack, and that subaddresses probably are providing the types of protections that you're hoping for.

[20:11] The fifth case is very basic: don't share exchange subaddresses because there's no reason to. Just use your own subaddress as an intermediary if needed, and then take note of who you give your subaddresses to that are derived from specific seeds. If you have some idea of what your type of subaddress exposure is, it can help you manage it a lot better.

[20:35] Alright, so that's all I wanted to cover today for this episode of Breaking Monero. I know we covered some pretty interesting stuff today, at least in my opinion. Some off- and on-chain transaction association and subaddress association, so I had a fun time and I hope that you enjoyed it. We'll catch you in the next episode of Breaking Monero. Take care.
