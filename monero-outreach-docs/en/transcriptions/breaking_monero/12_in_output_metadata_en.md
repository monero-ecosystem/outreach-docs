# Breaking Monero 12: Input/Output Metadata

**Breaking Monero Episode 12: Input/Output Metadata**

https://youtu.be/-zJpvsj1rWE

In this episode, we discuss how the metadata collected by looking at the number of inputs and outputs can limit privacy in some circumstances. We warn against leaking metadata through unusual or repeated, predictable behavior. 

[github.com/noncesense-research-lab/tx_in_out_distribution](https://github.com/noncesense-research-lab/tx_in_out_distribution)  

_**Episode Transcription**_
---

_**Justin:**_ Hello and welcome back to another episode of Breaking Monero. Today, Sarang and I will be talking about the Input/Output structure of Monero transactions. When you send Monero transactions, you reveal to the rest of the network how many inputs and how many outputs are sent in the transaction. You can think of outputs like dollar bills, some people call them notes, where they are just a container of money. I sometimes call them ‘bags of gold’ because you can have a varying amount of gold in there that you dump into other bags. That’s what an output is, but when you send Monero transactions, you may reveal a good amount of information with this metadata. So today, we’re going to talk about some considerations when you send transactions to help make sure that this metadata alone can’t severely undermine the privacy of your transactions. But first, we’re going to have Sarang talk about examples of the different transaction types that people make with Monero, the metadata on the number of inputs and outputs revealed, and then also talk about whether this is unique to Monero or not.

_**Sarang:**_ Sure, like you were saying, the idea is that a transaction is one or more inputs and one or more outputs. Inputs are spent in their entirety and generate outputs that go to different destinations or the same destination. This is not unique to Monero, this structure of consuming inputs and generating outputs is the way that Bitcoin and it’s family of similar asset types works, Monero uses it, of course. Even other privacy focused assets, like ZCash now use a similar structure, albeit applied in a different way. The number of inputs and outputs you have depend on what you’re trying to do. As we’ll see later, most commonly we consume one, maybe two inputs depending on the total hidden value contained in those, and typically you’ll have one destination output, and one other output where the change, the remaining balance, is sent back to you. This is all protected by the idea of Monero’s stealth addresses. And of course, each of the inputs that you spend is still obscured by its own separate ring of decoys in a ring signature. There are some big exceptions to this. One example is the idea of pool payouts. Pool payouts are often sending a fixed amount of Monero to a bunch of different recipients in their pool. Often times these will have many different outputs. Monero currently, because of how Bulletproofs work, has a limit of 16 outputs. But you’ll often see this kind of transaction and you could probably surmise that it’s a pool payout. Another thing you might try to do is called a churn. In a churn, you basically send funds to yourself which may be an attempt to obscure the fact that funds you received are going to be later used for another purpose, although it’s a bit tricky to do this correctly. Often those will consume a single input and the ideally generate two outputs, one to yourself and one to change. It’s worth noting, and we’ll talk about this later too, that by default Monero will always have at least two outputs because most transactions use two anyway and we don’t want to reveal information that would be caused by sending a single output which could, under certain circumstances, reveal information about that output and also signal to an adversary that a churn operation, where you’re just sending to yourself an nowhere else, might be in progress.

_**Justin:**_ Adding on to the one output consideration, the Monero software will not allow you to send transactions with only one output for several reasons. First, if the user was trying to do a churn type transaction, it would often look like the case where there’s one input and one output, where users are sending the entire value of the output to themselves. And that’s the issue with one output transactions is that you know that the entire value of all the inputs, whether it’s one input or five inputs is all sent to one output, it’s all sent to one recipient. You know that the entire value of all these outputs is spent. By making it so there are at least two outputs, you might still spend the entire value of all these inputs with one individual, but then it fits in with all the other transactions that have change. So even if you don’t have change, by having a two output minimum, even if one is empty, a zero output, then you’re able to hide among the other normal transactions that have change. So it helps hide certain things like churn transactions, it also helps make sure that transactions in general look more homogeneous. With Monero, the wallet minimum is two outputs which is necessary to prevent people knowing that the entire value of all the inputs is used up in that transaction and not some of it returned as change. This is a really important distinction. We also want to stress that even if certain cryptocurrency implementations have really strong privacy otherwise, this is generally a piece of metadata that’s revealed even in these really good implementations. With Monero, even if you could assume perfect ring signature privacy, with enormously large ring sizes, you would still know the number of inputs and outputs sent in the transaction, so you still might be able to infer that this transaction is a pool payout or an exchange batch withdrawal because they pay 16 people. It’s not typical user behavior to pay 16 people at a time. Those sorts of things are important for many implementations, not just Monero, but other privacy implementations, like ZCash where they might otherwise have good privacy properties, but this metadata is often leaked to others. Sarang, is there anything else you’d like to cover on this point before I move to showing some of the data in regards to how people have spent Monero related to the number of inputs and outputs.

_**Sarang:**_ Yes, we did say that one of the things that we’d ideally like to do is try to make all transactions look as similar as possible from a metadata perspective. If every single transaction were two inputs and two outputs, or something like that, you might say “Great, all the transactions look pretty similar, privacy must be great” and from a certain perspective, that is true. The way that I like to look at this is how Monero used to allow any ring size you wanted, down to some minimum if you wanted. If you wanted a really large ring size you can do that, but even after we chose the standardize on a fixed ring size, which is 11 right now, so every ring for any input spent must contain 11 total ring members. Even with that, it does not automatically mean that because that part of transactions was homogenized that that solved all the privacy woes that folks might have. It’s one aspect to transaction metadata, fixing it is not necessarily sufficient to solve all the particular privacy based use cases that folks have. We’d like to homogenize things as much as possible, but that’s not necessarily enough. It’s also worth noting that with the idea of one output transactions, mathematically if we did allow those, it might be possible for me to send Justin a transaction with one output, and then for Justin to send me a transaction back with one output, and under certain circumstances like that there is additional data that could be leaked. Besides the fact that it would also say that the entire value of the output was sent to Justin, there are other concerns too. So we like to require at least two outputs, either within the wallet software or maybe eventually as a consensus rule.

_**Justin:**_ That’s a really good point. The number of inputs and outputs is an important consideration, but it’s certainly not the only consideration. You still need to worry about things like the general strength of your ring signature, also time analysis and everything else we’ve talked about in previous episodes. Those don’t go away just because you’re following these best practices, it’s an additional set of best practices that you should add to rest of the pile. One other thing I want to add quickly, before moving on, it’s often the case that people will try to look at several transactions in a row that meet a specific payout structure. So if we look at something like mining pools, mining pools are sort of a mediocre example because as you mentioned in a previous episode they often make data public. Let’s suppose that we’re talking about a private mining pool that keeps things in-house, they don’t share this information with others. With these private mining pools, they typically will make this 16 output transactions continuously. So it’s often the case that a mining pool will pay out 15 people and have one output as change back to themselves and then they’ll use that output in another 16 output transaction. You can look at the outputs generated by the pool and say that I know the change to the pool most likely will be spent in another 16 output transaction, so I’m going to specifically look for transactions that meet this metadata, or that I’m looking for transactions in the future that have 16 outputs. By doing so it can reduce the anonymity set further. This is an example of a heuristic that you could use to learn more information about users. This could also be the case with churning, let’s say for some reason you may suspect that a user may churn eight times, let’s say. You’d need some way to come up with this information in the first place, but let’s say due to some knowledge of information, you know they will churn eight times. Well, you might look for a path of one input and two output transactions eight times and there might not be thousands of routes that look like that, there might only be a dozen or so. Now your anonymity set is lower because someone has knowledge of how you’re trying to transact and this metadata could be used to learn more information. It’s also not just a case of per transaction basis, it also matters if someone has an understanding of what your general spending behaviors are, they can use this metadata to facilitate some other investigations. So, other interesting things you can do with metadata analysis, in general with Monero if you have predictable repeated behavior, it’s generally a problem and this metadata that leaked from the number of inputs and outputs is another thing to worry about. I’m going to share my screen and show some of the information that was selected based off Monero transaction history. I have an [Excel document](https://github.com/noncesense-research-lab/tx_in_out_distribution) pulled up here, this is information prepared by the [Noncesense Research Lab](https://github.com/noncesense-research-lab/) headed up by Isthmus and a few others. They scanned the Monero blockchain, for this data it’s specifically related to Ring CT outputs only, so they have information on all outputs, but these are just outputs created in 2017 onward. It does not include Monero’s early outputs. And we can see the distribution of inputs, the distribution of outputs and they also looked at the number of one output transactions. So we’ll look at all of those very briefly. As you can see here, that about 49% of Monero transactions have one input and 41% have two inputs, only about 9% have any other number. The maximum number of inputs, at least at the time they prepared this data was 1,187, so just a fun fact for you there. They key takeaway from this is if you’re sending a transaction with more than two inputs, you are at least falling outside of the typical zone. If you’re sending a transaction with only one or two inputs, you have a pretty big crowd to hide in. I mentioned that it matters what other transactions you make too, but in general, for one given transaction, it’s pretty typical to see those one and two inputs. If you make a transaction with say, 77 inputs, there are only 100 transactions in Monero’s recent history that have this, it’s much less frequent and if you go down to say 5 transactions with 193 inputs then you would be more revealing than compared to how you might otherwise look. That’s just one thing to keep in mind, most people spend transactions with one or two inputs with Monero. If you look at the outputs, it’s even more stark. Here’s sorted by the number, here’s sorted by the transaction count. 91% of Monero transactions have two outputs, again Ring CT transactions. So you can see that there’s an extraordinary skew here where two outputs is vastly over represented compared to any other number. I also highlighted 16 here, again this is the maximum you can spend with Bulletproofs, these higher number were spent before Bulletproofs. But you can see that there’s only 13,703 transactions at the time this was written. Which would suggest that if you look at a 16 output transaction, there’s a really good chance that it’s related to an exchange or a pool payout. That helps you as an investigator to learn a little bit more about the Monero blockchain. Now, this is something that really annoying, there are 2,522 transactions with only 1 output. As I mentioned, the Monero wallet software will not let you send these transactions, that means that these 2,522 transactions were sent with some custom wallet that someone created and were able to have them confirmed in the blocks. This is something that going into the future, Sarang and I recommend that this should be a consensus requirement that these are not allowed at all, but as of right now there are 2,522 of them. We can actually look at the distribution of that. These are all of them here, these are all of the transaction outputs, all of this information is available publically on [their github](https://github.com/noncesense-research-lab/tx_in_out_distribution) and we can look at a histogram here and can see that not too many were created before April 2018, but through April, May, going through July, that’s when the vast majority of these one output transactions were created. Around October 2018 there were fewer of them created and as a result it looks like someone was really trying to test it around this time period. There was a Monero fork around this time period, so it’s interesting if you’re trying to investigate the Monero blockchain to see what people were doing over these time periods and these one output transactions certainly help share a little bit there. So that’s just one thing that I found was pretty interesting that the Noncesense Research Lab put together looking at the distribution of Monero inputs and outputs. It can be really useful to help give you a basic understanding of whether what you’re doing is common among Monero network participants or not. This may change over time, for example you can’t send transactions with greater 16 outputs at this point, so the proportion of those with more that 16 is decreasing, but it’s just a really good way to look at how people are generally spending the funds. Sarang, can you talk a little bit more about what this metadata means to people, how they should be concerned about sending these transactions with either a normal amount of inputs and outputs or where a very unusual amount of inputs/outputs are used?

_**Sarang:**_ Typical transactions, as we’ve seen are almost always one or two inputs and then a minimum of two outputs. The number of inputs can change, of course, depending on the types of funds you’re trying to send, in any given transaction you need to have enough funds in the combined outputs that you’re spending in order to make the transaction balance. There might be circumstances where you only have little bits of change left over that need to be pulled into the transaction which will increase the number of inputs. If at all possible, by using standard wallet software, the wallet will often try to make reasonable and smart decisions about how to setup transactions in this way and require two or more outputs to avoid the issue where you know that all of the inputs have been spent. Even if you’re very careful about making sure you always have a reasonable number of inputs and outputs to make sure your transaction can hide in the crowd, as we’ve said, certain kinds of predictable behavior could make you stand out. If an adversary happens to know that the software you’re using, or that your own behavior leads to you churning a certain number of times, that might imply a certain structure to your transactions that the adversary might try to look at in this big, broad Monero transaction graph, which reduces the size of the crowd that you get to hide in. Ideally, spending behavior should be as similar to the crowd as possible and should be as unpredictable as possible.

_**Justin:**_ All right, thanks. Besides those two things, are there any other recommendations you have for users?

_**Sarang:**_ For most different threats and use case models, using the standard Monero software as usually is typically a reasonable way to do things. If you are concerned about targeted analysis towards you, you might want to be concerned about many types of metadata, which could involve things like sending transactions around the same time, or from the same IP address every time or making sure that you’re not using custom wallet designs that may make poor decisions, or lookout for very common, repeated churn behavior that always looks the same.

_**Justin:**_ All right, thanks Sarang. Is there anything else you want to leave the listener with?

_**Sarang:**_ Just that this is one particular kind of metadata that is absolutely not unique to Monero, but it’s something interesting to think about. It’s a type of metadata that is very difficult for us to homogenize. Ring size is very easy for us to manage, we just say that that’s a system parameter. But the reason that most digital assets, like Monero and others have fixed input/output structures is because that particular kind of metadata is very, very difficult to hide in a smart way. Attempts to try to make transactions more homogeneous could lead to behavior like very regular, repeated, predictable churn which itself can leave a fingerprint. For many threat models and use cases, the standard use of the default Monero wallet is just fine.

_**Justin:**_ All right, thank you so much Sarang for joining me today, thanks everyone for watching this episode of Breaking Monero. Catch you in the next one.
